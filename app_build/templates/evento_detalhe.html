{% extends 'base.html' %}

{% block content %}
    
    <div class="detalhe-evento-wrapper">
        <div class="detalhe-header">
            <h1>{{ evento.nome }}</h1>
            <span class="evento-status status-{{ evento.status.lower() }}">{{ evento.status }}</span>
        </div>
        
        <div class="detalhe-body">
            
            <!-- Se√ß√£o Principal -->
            <div class="info-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <div>
                    <p><strong>Jogo:</strong> {{ evento.jogo }}</p>
                    <p><strong>Organizado por:</strong> {{ evento.organizador.nome }}</p>
                    <p><strong>Local:</strong> {{ evento.local }}</p>
                </div>
                <div>
                    <!-- Exibe Data E Hora formatados -->
                    <p><strong>Data:</strong> {{ evento.data.strftime('%d/%m/%Y') }}</p>
                    <p><strong>Hor√°rio:</strong> {{ evento.horario.strftime('%H:%M') }}</p>
                    
                    <p><strong>Vagas:</strong> {{ evento.limite_jogadores or "Ilimitadas" }}</p>
                    <p><strong>Faixa Et√°ria:</strong> {{ evento.faixa_etaria or "Livre" }}</p>
                </div>
            </div>

            <!-- Nova Se√ß√£o: Descri√ß√£o -->
            {% if evento.descricao %}
                <div class="evento-descricao" style="margin-bottom: 30px; padding: 20px; background: #f9f9f9; border-radius: 5px;">
                    <h3>Sobre este Evento</h3>
                    <!-- 'nl2br' (newline to break) n√£o existe nativo no Jinja padr√£o do Flask sem filtro, 
                         ent√£o usamos style white-space: pre-wrap para respeitar os par√°grafos -->
                    <p style="white-space: pre-wrap;">{{ evento.descricao }}</p>
                </div>
            {% endif %}

            <!-- Nova Se√ß√£o: Link Externo -->
            {% if evento.link_externo %}
                <div style="margin-bottom: 20px;">
                    <a href="{{ evento.link_externo }}" target="_blank" class="btn btn-secondary">
                        üåê Acessar P√°gina Externa / Discord
                    </a>
                </div>
            {% endif %}

        </div>

        <div class="detalhe-actions">
            
            <!-- L√≥gica de Bot√µes (igual a antes) -->
            {% if user_session.user_type == 'organizador' and user_session.user_id == evento.organizador_id %}
                
                {% if evento.status == 'Ativo' %}
                    <a href="{{ url_for('encerrar_evento', id=evento.id) }}" class="btn btn-encerrar">Encerrar Evento</a>
                    <a href="{{ url_for('gerenciar_inscricoes', id=evento.id) }}" class="btn btn-primary">Gerenciar Inscri√ß√µes</a> 
                {% else %}
                    <a href="{{ url_for('gerenciar_inscricoes', id=evento.id) }}" class="btn btn-primary">Ver Lista de Participantes</a>
                    <p class="evento-finalizado-msg" style="margin-top: 10px;">Este evento j√° foi finalizado.</p>
                {% endif %}

            {% elif user_session.user_type == 'jogador' %}
                
                {% if evento.status == 'Ativo' %}
                    {% if is_inscrito %}
                        <a href="{{ url_for('cancelar_inscricao', id=evento.id) }}" class="btn btn-cancelar">Cancelar Inscri√ß√£o</a>
                        <p style="margin-top: 10px; color: green;">‚úî Voc√™ est√° inscrito neste evento.</p>
                    {% else %}
                        <a href="{{ url_for('inscrever', id=evento.id) }}" class="btn btn-primary">Quero Participar!</a>
                    {% endif %}
                {% else %}
                    <p class="evento-finalizado-msg">Este evento j√° foi finalizado. Inscri√ß√µes encerradas.</p>
                {% endif %}
            
            {% elif user_session.user_type == 'organizador' %}
                 <p>Voc√™ est√° vendo este evento como um Organizador (voc√™ n√£o √© o dono).</p>
            {% endif %}

        </div>
    </div>
        
{% endblock %}